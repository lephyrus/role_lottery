<!doctype html>
<html lang="en" class="sl-theme-dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>ðŸš§ role_lottery</title>

    <!-- Inter font -->
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />

    <!-- Shoelace -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css"
    />
    <script type="module" data-shoelace="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/dist">
      // the `data-shoelace` attribute above is required for the icons to be loaded from the correct URL
      const shoelaceVersion = "2.20.1";
      const components = [
        "alert",
        "avatar",
        "button",
        "card",
        "icon",
        "input",
        "rating",
        "tooltip"
      ];

      // mechanism to avoid "flash of undefined custom elements"
      // see: https://www.abeautifulsite.net/posts/revisiting-fouce

      // hide everything
      document.documentElement.style.opacity = 0;
      await Promise.race([
        // wait until all components are available (or have failed loading)
        loadShoelaceComponents(shoelaceVersion),
        // ...or at most 1 second
        new Promise((resolve) => setTimeout(resolve, 1000))
      ]);
      // ... then extend the rating component (but don't wait on that)
      extendRatingComponent();
      // ... then make the page visible
      document.documentElement.style.opacity = null;

      function loadShoelaceComponents(version) {
        const cdnHost = "https://cdn.jsdelivr.net";
        const shoelacePath = "/npm/@shoelace-style/shoelace";
        const baseUrl = `${cdnHost}${shoelacePath}@${version}`;
        const componentsPath = "/cdn/components/";
        const esmPath = "/+esm"

        const importPromises = components.map((component) =>
          import(`${baseUrl}${componentsPath}${component}/${component}.js${esmPath}`)
        )

        return Promise.allSettled(importPromises);
      }

      async function extendRatingComponent() {
        // The Shoelace rating component has this weird `getSymbol` API, where the
        // property has to be set to a function that returns an HTML string used for
        // the rating icon. It's not possible to do this is Lustre, but we do want
        // Lustre to manage the element, so we extend the element and set the property
        // here.

        await Promise.race([
          // wait until the Shoelace rating component has been registered
          customElements.whenDefined("sl-rating"),
          // ... or at most 10 seconds
          new Promise((resolve) => setTimeout(resolve, 10000))
        ])
        const Rating = customElements.get("sl-rating");
        if (!Rating) {
          console.warn("Shoelace rating component not available, app not fully functional.");
        } else {
          class SlotRating extends Rating {
            constructor() {
              super();
              this.getSymbol = () => '<sl-icon name="person-circle"></sl-icon>';
            }
          }
          customElements.define("sl-slot-rating", SlotRating);
        }
      }
    </script>

    <!-- Theme  -->
    <style>
      :root {
        --sl-color-primary-50: rgb(254 248 250);
        --sl-color-primary-100: rgb(253 230 239);
        --sl-color-primary-200: rgb(252 211 227);
        --sl-color-primary-300: rgb(250 190 213);
        --sl-color-primary-400: rgb(248 160 194);
        --sl-color-primary-500: rgb(245 117 166);
        --sl-color-primary-600: rgb(241 55 127);
        --sl-color-primary-700: rgb(209 23 95);
        --sl-color-primary-800: rgb(174 19 79);
        --sl-color-primary-900: rgb(126 14 57);
        --sl-color-primary-950: rgb(80 9 36);

        --sl-input-focus-ring-color: var(--sl-focus-ring-color);
      }

      :root {
        font-family: Inter, sans-serif;
        font-feature-settings:
          "liga" 1,
          "calt" 1; /* fix for Chrome */
        --sl-font-sans: "Inter", sans-serif;
      }
      @supports (font-variation-settings: normal) {
        :root {
          font-family: InterVariable, sans-serif;
          --sl-font-sans: "InterVariable", sans-serif;
        }
      }
    </style>

    <link rel="stylesheet" href="./priv/static/role_lottery.css"></link>
    <script type="module" src="./priv/static/role_lottery.mjs"></script>
  </head>

  <body>
    <div id="app"></div>
  </body>
</html>
